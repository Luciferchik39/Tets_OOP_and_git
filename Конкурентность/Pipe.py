from multiprocessing import Pipe, Process
import os

"""
Pipe (—Ç—Ä—É–±–∞/–∫–∞–Ω–∞–ª) ‚Äî —ç—Ç–æ –¥–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∞—Ä—É —Å–æ–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏.
conn.send(obj)	–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
conn.recv()	–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç)
conn.poll([timeout])	–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á—Ç–µ–Ω–∏—è
conn.close()	–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
conn.fileno()	–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ Pipe vs Queue:
–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       	            Pipe	       Queue
–°–∫–æ—Ä–æ—Å—Ç—å	                  üöÄ –ë—ã—Å—Ç—Ä–µ–µ  	|  üê¢  –ú–µ–¥–ª–µ–Ω–Ω–µ–µ
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤	       –¢–æ–ª—å–∫–æ 2	    |     –ú–Ω–æ–≥–æ
–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å	           ‚ùå –ù–µ—Ç	    |  ‚úÖ –î–∞
–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–æ—Å—Ç—å	        ‚úÖ –î–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)	|  ‚ùå –ù–µ—Ç (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è)
–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è	        –°—Ä–µ–¥–Ω—è—è	            |     –í—ã—Å–æ–∫–∞—è

"""

def worker(p: Pipe):
    some_date = 100500
    p.send(some_date)

def two_wworker(obj, p: Pipe):

    p.send(obj)
    print(f'–ü–µ—Ä–µ–¥–∞–ª–∏ {obj} –≤ —è–¥—Ä–æ –û–°')


if __name__ == '__main__':
    print(f'–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å {os.getpid()}')
    parent_pipe, child_pipe = Pipe()
    p = Process(target=worker, args=(child_pipe,))
    p.start()
    p2 = Process(target=two_wworker, args=(child_pipe,))
    p2.start()
    print(f'–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ {os.getpid()} –≤–µ—Ä–Ω—É–ª–∞: {parent_pipe.recv()}')
    parent_pipe.send("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞")
    """–Ω–∞ —ç—Ç–∞–ø–µ recv –º—ã –ø–æ–ª—É—á–∞–µ–º –∫–æ–ø–∏—é –∏–∑ —è–¥—Ä–∞ –û–° –∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –æ—Ç —Ç—É–¥–∞"""
    print(parent_pipe.recv())
    print(child_pipe.recv()) # –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –∏—Å—á–µ—Ä–ø–∞–ª–∏ –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
    print(child_pipe.poll()) # —Ç–∞–∫ –∫–∞–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ—Ç —Ç–æ –±—É–¥–µ—Ç False
    parent_pipe.send('–µ—â—ë —á—Ç–æ —Ç–æ –ø–µ—Ä–µ–¥–∞–ª–∏') # –ø–æ—è–≤–∏–ª—Å—è –æ–±—ä–µ–∫—Ç –≤ poll –∏ –µ–≥–æ –µ—â—ë –Ω–µ –≤—ã–∑–≤–∞–ª–∏
    print(child_pipe.poll()) # True
    p.join()
    p2.join()

    """         
    –ü–æ–¥—Ö–æ–¥	           –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å	    –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å	    –°–ª–æ–∂–Ω–æ—Å—Ç—å
    Pipe –±–µ–∑ lock	     ‚ùå –û–ø–∞—Å–Ω–æ	    üöÄ –í—ã—Å–æ–∫–∞—è	               üü¢ –ù–∏–∑–∫–∞—è
    Pipe + lock	        ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ	üê¢ –°—Ä–µ–¥–Ω—è—è	               üü° –°—Ä–µ–¥–Ω—è—è
    Queue	            ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ	üê¢ –°—Ä–µ–¥–Ω—è—è	               üü¢ –ù–∏–∑–∫–∞—è
    """
