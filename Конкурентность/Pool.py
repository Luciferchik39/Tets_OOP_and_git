from random import randint
import os
from multiprocessing import Process
from datetime import datetime
import multiprocessing
"""
–ß—Ç–æ —Ç–∞–∫–æ–µ Pool?
–≠—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–≤–æ—Ä–∫–µ—Ä–æ–≤) –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ–∂–¥—É –Ω–∏–º–∏ –∑–∞–¥–∞—á–∏. 
–ü—Ä–æ—Ü–µ—Å—Å—ã –∂–∏–≤—É—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á.

Pool –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –∑–∞–¥–∞—á. –î–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ Process —Å Queue/Pipe.
–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è
–û–¥–∏–Ω —Ä–∞–∑ —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã ‚Üí –º–Ω–æ–≥–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ–º ‚Üí –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–∫—Ä—ã–ª–∏

–ò–¥–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
‚úÖ –ú–Ω–æ–≥–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –∑–∞–¥–∞—á ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 1000 —Ñ–∞–π–ª–æ–≤, 10000 URL
‚úÖ –ó–∞–¥–∞—á–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–π –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
‚úÖ –•–æ—á–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É ‚Äî –Ω–µ —Å–æ–∑–¥–∞—Ç—å 1000 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∞ —Ç–æ–ª—å–∫–æ 4
‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ª–≥–æ ‚Äî —Å–¥–µ–ª–∞–ª–∏ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º
‚úÖ –ù—É–∂–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–∑–æ–≤–∞ ‚Äî map —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫

–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚ùå –ó–∞–¥–∞—á–∏ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
‚ùå –ù—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (—Ç—É—Ç –ª—É—á—à–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Process)
‚ùå –í—Å–µ–≥–æ 2-3 –∑–∞–¥–∞—á–∏ (–æ–≤–µ—Ä—Ö–µ–¥ –ø—É–ª–∞ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω)
‚ùå –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
"""

# with open('file.txt', 'w') as f:
#     for _ in range(10_000_000):
#         """
#         –†–µ–∂–∏–º	    –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç	                      –ï—Å–ª–∏ —Ñ–∞–π–ª –µ—Å—Ç—å
#     'w' (write)	    ‚úÖ –°–æ–∑–¥–∞–µ—Ç	                //  ‚ôªÔ∏è   –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç (–æ—á–∏—â–∞–µ—Ç –∏ –ø–∏—à–µ—Ç –∑–∞–Ω–æ–≤–æ)
#     'x' (exclusive)	‚úÖ –°–æ–∑–¥–∞–µ—Ç	                //  ‚ùå –û—à–∏–±–∫–∞ FileExistsError
#     'a' (append)	‚úÖ –°–æ–∑–¥–∞–µ—Ç	                //  ‚ûï –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω–µ—Ü
#     'r' (read)	    ‚ùå –û—à–∏–±–∫–∞ FileNotFoundError	//  ‚úÖ –ß–∏—Ç–∞–µ—Ç
#     """
#         # line = ''.join(str(randint(0, 9)) for _ in range(50))
#         # f.write(f'{line}\n')
#         f.write(f'{randint(0, 9)}\n')

def laba(a):
    result = 0
    with open('file.txt', 'r') as f:
        for s in f:
            result += randint(0, int(s))
    print(f'–ü—Ä–æ—Ü–µ—Å—Å PID: {os.getpid()}, –≤–µ—Ä–Ω—É–ª –∑–Ω–∞—á–µ–Ω–∏–µ: {result}')

# if __name__ =='__main__':
#     print(f"–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä—Ü–æ–µ—Å—Å PID: {os.getpid()}")
#     start = datetime.now()
#     proc = Process(target=laba)
#     proc_two = Process(target=laba)
#     proc.start()
#     proc_two.start()
#     print('—Å–æ–∑–¥–∞–∏ –∏ –∑–∞—É–ø—Å—Ç–∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã')
#     proc.join()
#     proc_two.join()
#     print('–¥–æ–∂–¥–∞–ª–∏—Å—å –∑–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤')
#     print(datetime.now() - start)

# if __name__ =='__main__':
    '''
    –û–°–û–ë–ï–ù–ù–û–°–¢–ò –ñ–ò–ó–ù–ò –ü–†–û–¶–ï–°–°–û–í:

    ‚úÖ –î–µ—Ç–∏ –º–æ–≥—É—Ç –∂–∏—Ç—å –¥–æ–ª—å—à–µ —Ä–æ–¥–∏—Ç–µ–ª—è!
    ‚úÖ –†–æ–¥–∏—Ç–µ–ª—å –±–µ–∑ join() - —Å–∏—Ä–æ—Ç—ã –ø—Ä–∏ –∂–∏–≤—ã—Ö –¥–µ—Ç—è—Ö
    ‚úÖ –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ stdout –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º –ø–∏—Å–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å
    ‚úÖ –û–° —Å–∞–º–∞ –ø–æ–¥—á–∏—Å—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö
    
    üéØ –ü–†–ê–í–ò–õ–û:
    - –ù—É–∂–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ—Ç–µ–π ‚Üí join()
    - –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –¥–µ—Ç–∏ –∂–∏–ª–∏ –ø–æ—Å–ª–µ —Ä–æ–¥–∏—Ç–µ–ª—è ‚Üí –º–æ–∂–Ω–æ –Ω–µ join()
    - –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –¥–µ—Ç–∏ —É–º–µ—Ä–ª–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª–µ–º ‚Üí daemon=True
    
    –¢–í–û–ô –°–õ–£–ß–ê–ô:
    –†–æ–¥–∏—Ç–µ–ª—å —É–º–µ—Ä, –¥–µ—Ç–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏ –≤—ã–≤–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã 
    –≤ –∫–æ–Ω—Å–æ–ª—å –ø–æ—Å–ª–µ –µ–≥–æ —Å–º–µ—Ä—Ç–∏ - –≠–¢–û –ù–û–†–ú–ê–õ–¨–ù–û!
    '''
    # print(f"–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä—Ü–æ–µ—Å—Å PID: {os.getpid()}")
    # start = datetime.now()
    # p_list = [Process(target=laba) for _ in range(2)]
    # for p in p_list:
    #     p.start()
    # # for p in p_list: # –±–µ–∑ —ç—Ç–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É –Ω–æ —ç—Ç–æ –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç —Ä–∞–±–æ—Ç–µ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    # #     p.join()
    #
    # print(datetime.now() - start)

"""
Deadlock (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞):
–°–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞:
–ü—Ä–æ—Ü–µ—Å—Å –ê –∑–∞—Ö–≤–∞—Ç–∏–ª Lock1, –∂–¥–µ—Ç Lock2
–ü—Ä–æ—Ü–µ—Å—Å –ë –∑–∞—Ö–≤–∞—Ç–∏–ª Lock2, –∂–¥–µ—Ç Lock1
–û–±–∞ –≤–∏—Å—è—Ç –≤–µ—á–Ω–æ!
"""
if __name__ =='__main__':
    print(f"–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä—Ü–æ–µ—Å—Å PID: {os.getpid()}")
    start = datetime.now()
    # Pool —É–¥–æ–±–µ–Ω —Ç–µ–º —á—Ç–æ –º–æ–∂–Ω–æ –æ–¥–Ω—É –∏ —Ç—É–∂–µ —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–∑–≤–∞—Ç—å
    # –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
    with multiprocessing.Pool(2) as pool:
        pool.map(laba, (1, 2))
    print(datetime.now() - start)