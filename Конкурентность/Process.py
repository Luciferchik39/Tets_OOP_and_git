"""
‚ùå –ü—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ os.fork() –ù–ï–¢
‚ùå –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ–ø–∏—Ä—É—é—â–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—è
‚ùå –ù–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (2‚Åø)

‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π multiprocessing.Process (—ç—Ç–æ spawn)
‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞–π –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ args –∏–ª–∏ Queue
‚úÖ –î–ª—è fork-–ø–æ–≤–µ–¥–µ–Ω–∏—è - —Å—Ç–∞–≤—å WSL –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π Linux

–ì–õ–ê–í–ù–û–ï –û–¢–õ–ò–ß–ò–ï:
fork = "–∫–ª–æ–Ω–∏—Ä—É–π –º–µ–Ω—è –ø–æ–ª–Ω–æ—Å—Ç—å—é"
spawn = "–∑–∞–ø—É—Å—Ç–∏ –Ω–æ–≤—É—é –∫–æ–ø–∏—é —Å –Ω—É–ª—è
time.sleep() –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—ë (–≤ –æ–±—ã—á–Ω–æ–º –∫–æ–¥–µ)
await asyncio.sleep() –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
1. –í—ã—Å–æ–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã —Ä–∞—Å—Ö–æ–¥—ã, –∑–∞ —Å—á—ë—Ç —Ç–æ–≥–æ —á—Ç–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–∏–¥—ë—Ç—Å—è –∑–∞–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–∏—Ç–∞—Ç–æ—Ä –∏ –ø—Ä–æ–≥—Ä—É–∂–∞—Ç—å —Ç—É–¥–∞
–≤—Å–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã –º–æ–∂—É–ª–∏
2. –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–º–µ—é—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –Ω–∏–º–∏ –ø—Ä–∏–¥—ë—Ç—Å—è —Å–æ–æ—Ä—É–∂–∞—Ç—å –∫–æ—Å—Ç—ã–ª–∏

–†–ê–°–•–û–î–´ –í MULTIPROCESSING:

‚è±Ô∏è –ü–û –í–†–ï–ú–ï–ù–ò (CPU):
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –û–°)
- –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ Python
- –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –∑–∞–Ω–æ–≤–æ
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

üíæ –ü–û –ü–ê–ú–Ø–¢–ò (RAM):
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä (~30-50 MB)
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å - –∫–æ–ø–∏—è –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å - –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å shared memory)

üìä –ù–ê–ì–õ–Ø–î–ù–û:
–ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–µ—Å–∏—Ç 200 MB –∏ —Å–æ–∑–¥–∞–µ—Ç 4 –ø—Ä–æ—Ü–µ—Å—Å–∞:
200 MB √ó 4 = 800 MB + —Ä–æ–¥–∏—Ç–µ–ª—å = 1 GB!

üõ†Ô∏è –ö–ê–ö –ë–û–†–û–¢–¨–°–Ø:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pool() –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—è–∂–µ–ª—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç–æ–ª—å–∫–æ –≥–¥–µ –Ω—É–∂–Ω–æ
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å shared memory –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. –ù–∞ Windows - –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –∫ —Ä–∞—Å—Ö–æ–¥–∞–º (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!)

 Resource Tracker
 —ç–ª–µ–º–µ–Ω—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã multiprocessing, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–∞ Windows –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ —á–∏—Å—Ç–æ–π.
 –í –º–∏—Ä–µ Unix —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ: –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–º–∏—Ä–∞–µ—Ç, —è–¥—Ä–æ –û–° —Å–∞–º–æ –ø—Ä–∏–±–∏—Ä–∞–µ—Ç –∑–∞ –Ω–∏–º. –ù–∞ Windows –≤—Å—ë —Å–ª–æ–∂–Ω–µ–µ.
 –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É multiprocessing –Ω–∞ Windows (–∞ —Ç–∞–∫–∂–µ –Ω–∞ POSIX-—Å–∏—Å—Ç–µ–º–∞—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤ 'spawn' –∏–ª–∏ 'forkserver')
 –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å-–º—É—Å–æ—Ä—â–∏–∫ ‚Äî Resource Tracker .
"""

import os
from multiprocessing import Process
import time

CNT = 0
print(f"üîç –ö–æ–¥ –í–ù–ï if __name__ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è!")
print(f"   __name__ = {__name__}")
print(f"   PID = {os.getpid()}")
print("-" * 30)


def funck():
    global CNT
    print(f"   üëâ –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ PID: {os.getpid()}")
    print(f"   üëâ __name__ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ = {__name__}")
    time.sleep(1)
    CNT += 2
    print(f"   üëâ CNT = {CNT}, PID: {os.getpid()}")


if __name__ == '__main__':
    print(f"üöÄ –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å PID: {os.getpid()}")
    print(f"   CNT –≤ –Ω–∞—á–∞–ª–µ = {CNT}")

    p_fater = Process(target=funck)
    p_fater.start()
    p_fater.join()

    p_2 = Process(target=funck)
    p_2.start()
    p_2.join()

    print(f"üèÅ CNT –≤ –∫–æ–Ω—Ü–µ = {CNT} (–≤ —Ä–æ–¥–∏—Ç–µ–ª–µ)")


"""
–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞	multiprocessing –Ω–∞ Windows (spawn)	fork –Ω–∞ Linux/macOS
–†–æ–ª—å —Ä–æ–¥–∏—Ç–µ–ª—è	–†–æ–¥–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏ –≤—ã–∑—ã–≤–∞–µ—Ç p.join() –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è.	–†–æ–¥–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å (–∫–ª–æ–Ω) –∏ –≤—ã–∑—ã–≤–∞–µ—Ç waitpid() .
–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–∂–∏–¥–∞–Ω–∏–∏	–†–æ–¥–∏—Ç–µ–ª—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Python –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.	–†–æ–¥–∏—Ç–µ–ª—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞ –û–°, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å .
–†–∏—Å–∫ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è	–î–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –Ω–æ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.	–î–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –∑–æ–º–±–∏ .
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–∂–∏–¥–∞–Ω–∏—è	–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ p.join().	–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ waitpid() .
"""

def vnuk(name):
    print(f'   üë∂ –°–æ–∑–¥–∞–Ω –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –æ—Ç –¥–æ—á–µ—Ä–Ω–µ–≥–æ —Å –∏–º–µ–Ω–µ–º {name} –µ–≥–æ PID: {os.getpid()}')
    time.sleep(5) # –∏–º–∏—Ç–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏—è
    print(f'   üë∂ –ü—Ä–æ—Ü–µ—Å—Å PID: {os.getpid()} –∑–∞–≤–µ—Ä—à–∏–ª—Å—è ')

def fater(name):
    print(f'  üë¶  –°–æ–∑–¥–∞–Ω –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å –∏–º–µ–Ω–µ–º {name} –µ–≥–æ PID: {os.getpid()}')
    p = Process(target=vnuk, args=('–ü—É–ø—Å',))
    p.start()
    p.join()
    print(f"  üë¶ –î–æ—á–µ—Ä–Ω–∏–π: –≤–Ω—É–∫ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è, –ø—Ä–æ–¥–æ–ª–∂–∞—é...")
    time.sleep(2)
    print(f"  ‚úÖ –î–û–ß–ï–†–ù–ò–ô: PID={os.getpid()} –∑–∞–≤–µ—Ä—à–∏–ª—Å—è")

if __name__ == '__main__':
    print(f'–†–æ–¥–∏—Ç–µ–ª—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å PID: {os.getpid()}')
    p_fater = Process(target=fater, args=('–ü—ë—Ç—Ä',))
    p_fater.start()
    print(f"üë® –†–æ–¥–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª –¥–æ—á–µ—Ä–Ω–∏–π —Å PID={p_fater.pid}")
    p_fater.join()
    print(f"üë® –†–û–î–ò–¢–ï–õ–¨: –¥–æ—á–µ—Ä–Ω–∏–π –∑–∞–≤–µ—Ä—à–∏–ª—Å—è, –≤—Å—ë –≥–æ—Ç–æ–≤–æ!")

